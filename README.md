# Gimbal Control for Pointing at Target <a name="head-brief"></a>
**Ankith Kunduru** Rutgers University, New Brunswick NJ \
RoboWork Lab, University of Nevada Reno, NV  
&nbsp;  
The following instructions will describe my progress with the current gimbal alignment system.
The system is meant to take 'sagebrush' coordinates as input and output the joint movements required to point at those coordinates.

Eventually, the bigger goal of this project is to use the map generated by the DENDrone, find goal sagebrush coordinates, send a pathing script to the drone to circle around those coordinates, and have the gimbal stay pointing to the sagebrush. The specific scope of this project is just the final step, having the gimbal dynamically point to specified coordinates. 

Currently, everything is encompassed within the catkin_ws/src/gimbal-control/gimbal_urdf ROS package. There are multiple ROS nodes that are being commonly used in this project, as labeled below.

## URDF Launch File
The first line to run on terminal is the launch file: 
```
rwl@rwl-ThinkPad-P51:~$ roslaunch gimbal_urdf display.launch
```
This URDF file (which may need some tweaking of axes) describes the current gimbal we are using. It was an stl file designed in SolidWorks and exported to URDF. 
The model of the gimbal and its axes are represented by the image on the left, however it may work better if the axes were rotated to mimic the diagram on the right.


![Gimbal configuration](https://github.com/user-attachments/assets/ae26e5b8-e623-4286-a76d-5ad52670444a)

(Left is current URDF configuration, right is what gimbal_ik_copterlab_v2 follows)


## New_IK

The next file to be discussed is new_ik.py. (Don't run it yet)
```
rwl@rwl-ThinkPad-P51:~$ rosrun gimbal_urdf new_ik.py
```
This ros node is based off of Christos' Inverse Kinematics tutorial code on roboticworkerslab.com. We extracted specifically scenario2, which is the full inverse kinematics scenario where we can plug in a goal end effector pose and get out results for joint angles. However, this node has been having problems adapting to a gimbal mechanism because the intention for this code is to replicate the position of the target as well as the orientation.

## Slider_Joints

Instead of using the display that Christos provides, we wanted to incorporate the inverse kinematics code into rViz, so to control the goal pose we have slider_joints.py, which can be run by doing:
```
rwl@rwl-ThinkPad-P51:~$ rosrun gimbal_urdf slider_joints.py
rwl@rwl-ThinkPad-P51:~$ rqt
```
RQT needs to be running beside this because the sliders in rqt are used to control the position of the goal pose. 
When you change the x, y, and z positions, slider_joints.py rotates the frame so that the y-axis aligns with gimbal's center. This is because the gimbal's end effector is aligned with the y-axis, and the new_ik script tries to align the end effector's frame with the sagebrush's frame.
If you run new_ik.py after running this, you should see that the gimbal's joints align with the pose that is moving around. If the pose isn't visible, check if rViz is displaying that topic. If the joints aren't moving, check if slider_joints.py is publishing to 'target_pose', and new_ik.py is subscribing to 'target_pose'. If still not working, make sure new_ik.py is publishing to rViz at all by making sure the joint state publisher has a rosparam of 'ik_joint_states'.

Slider_joints does have a flaw in that it creates the goal pose from an arbitrary point set in the center of where the gimbal rotates. (The arbitrary point is why I included -0.18 in the z value that is read) The input coordinates need to be translated into the frame of the end effector and then the sagepose.header.frame_id needs to be changed from 'base_link' to 'EE' (or cam_link, check URDF file). 

## Arrowmaker.py

Previously encompassed the function of slider_joints, which is why it is so convoluted. Now is used to display an arrow showing where the gimbal camera is currently facing.
```
rwl@rwl-ThinkPad-P51:~$ rosrun gimbal_urdf Arrowmaker.py
```
Arrowmaker has sentimental value to me because it was the first object-oriented program I've written, but most of its functionality is redundant and whatever functionality it does provide (displaying the arrow) can be easily simplified to a couple of lines.

## Additional

[Github Repo](https://github.com/ankithkunduru/gimbal-control) for gimbal control, which is connected to ~/catkin_ws/src/gimbal-control https://github.com/ankithkunduru/gimbal-control

Contact info: Ankith Kunduru, 732-809-2244, 1ankithk@gmail.com.

Please message me with ANY PROGRESS with the project. I got very invested in this project and it will be cool to see how it progresses. Also if you have questions I can answer I will.

## Bonus REU tips
If you are an REU student working on this:
### In the lab: 
There were a few weeks before I could even START helping out, it is normal to be stuck in tutorial hell for those few weeks. You don’t have to learn everything about ROS, just make sure to watch the videos in the roswiki. 

I was constantly wavering between feeling like I knew what I was doing and feeling completely lost throughout the REU, even in the last week, so don't worry about it.

Mentors are amazing and are always happy to help even if it seems like they are busy, so don’t feel like a burden to ask questions. They are also very smart and have a lot of experience, so try to learn as much as possible from them. 

Don’t worry too much about the paper/actual REU part of it. 
### Outside the lab
If you get sick for a few weeks (like I was) you may be allergic to sagebrush. Take a claritin. You also may be having a bad reaction to the water, try bottled for a few days.

Admin issues. Payments get delayed a lot: bug them often. 

Usually we get an airbnb in the last week because summer housing closes after the first week of August. 

Make friends with everyone, it makes the experience so much better. 

Don’t get caught in downtown Reno past 10 pm.
